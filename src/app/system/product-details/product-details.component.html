
<section *ngIf="!isFetchingProduct && !isErrorFetchingProduct">
  <span class="sm:flex items-start sm:space-x-4">
    <app-back-button></app-back-button>

    <section class="space-y-8 w-full">
      <!-- <p class="text-3xl font-medium"
        style="margin: 0;">
        Product Details
      </p> -->

      <section style="margin-top: 0rem;">
        <section class=" border-b-2 border-gray-200 pb-4">
          <section class="my-4 flex items-start space-x-16">
            <div class="my-4 sm:flex items-center sm:space-x-4">
              <svg xmlns="http://www.w3.org/2000/svg"
                enable-background="new 0 0 24 24"
                height="24px"
                viewBox="0 0 24 24"
                width="24px"
                fill="#000000">
                <g>
                  <rect fill="none" height="24" width="24"/>
                </g>
                <path d="M15,21h-2v-2h2V21z M13,14h-2v5h2V14z M21,12h-2v4h2V12z M19,10h-2v2h2V10z M7,12H5v2h2V12z M5,10H3v2h2V10z M12,5h2V3h-2V5 z M4.5,4.5v3h3v-3H4.5z M8,9H4C3.45,9,3,8.55,3,8V4c0-0.55,0.45-1,1-1h4c0.55,0,1,0.45,1,1v4C9,8.55,8.55,9,8,9z M4.5,16.5v3h3v-3 H4.5z M8,21H4c-0.55,0-1-0.45-1-1v-4c0-0.55,0.45-1,1-1h4c0.55,0,1,0.45,1,1v4C9,20.55,8.55,21,8,21z M16.5,4.5v3h3v-3H16.5z M20,9 h-4c-0.55,0-1-0.45-1-1V4c0-0.55,0.45-1,1-1h4c0.55,0,1,0.45,1,1v4C21,8.55,20.55,9,20,9z M19,19v-3l-4,0v2h2v3h4v-2H19z M17,12 l-4,0v2h4V12z M13,10H7v2h2v2h2v-2h2V10z M14,9V7h-2V5h-2v4L14,9z M6.75,5.25h-1.5v1.5h1.5V5.25z M6.75,17.25h-1.5v1.5h1.5V17.25z M18.75,5.25h-1.5v1.5h1.5V5.25z"/>
              </svg>
              <span>
                  <p class="short-margin font-medium text-gray-500 text-xs">
                      Barcode
                  </p>
                  <img src="../../../assets/images/barcode.png"
                    style="height: 45px; margin-top: .2rem" />
              </span>
            </div>
            <div class="my-4 flex items-center space-x-4">
              <svg xmlns="http://www.w3.org/2000/svg"
                enable-background="new 0 0 24 24"
                class="text-red-500 fill-current"
                height="24px"
                viewBox="0 0 24 24"
                width="24px"
                fill="#000000">
                <g><path d="M0,0h24v24H0V0z" fill="none"/></g>
                <g>
                  <g>
                    <path d="M20,4H4C2.9,4,2,4.9,2,6v12c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V6C22,4.9,21.1,4,20,4z M7.64,14.47 C7.64,14.76,7.4,15,7.11,15H7.02c-0.29,0-0.53-0.24-0.53-0.53V10.5l-0.45,0.33c-0.24,0.18-0.59,0.12-0.76-0.14 c-0.15-0.24-0.1-0.55,0.13-0.72L6.6,9.12C6.71,9.04,6.84,9,6.98,9c0.36,0,0.66,0.29,0.66,0.66V14.47z M13.01,15h-2.67 c-0.4,0-0.72-0.32-0.72-0.72c0-0.19,0.08-0.38,0.21-0.51c0.95-0.95,1.58-1.58,1.92-1.94c0.4-0.42,0.54-0.69,0.54-1.06 c0-0.4-0.31-0.72-0.81-0.72c-0.34,0-0.57,0.16-0.72,0.37c-0.15,0.2-0.41,0.26-0.64,0.16c-0.34-0.14-0.45-0.57-0.22-0.85 c0.15-0.19,0.37-0.38,0.67-0.53c0.69-0.33,1.48-0.2,1.95,0.03c0.86,0.44,0.91,1.24,0.91,1.48c0,0.64-0.31,1.26-0.92,1.86 c-0.25,0.25-0.72,0.71-1.4,1.39l0.03,0.05h1.88c0.27,0,0.49,0.22,0.49,0.49S13.28,15,13.01,15z M18.75,14.15 C18.67,14.28,18.19,15,16.99,15c-0.03,0-1.23,0.06-1.83-0.98c-0.15-0.26-0.04-0.6,0.24-0.71l0.12-0.05 c0.22-0.09,0.47-0.01,0.59,0.19c0.14,0.24,0.39,0.49,0.88,0.49c0.41,0,0.89-0.28,0.89-0.77c0-0.55-0.48-0.79-1.04-0.79l0,0 c-0.27,0-0.49-0.23-0.49-0.5c0-0.26,0.2-0.47,0.45-0.49l0-0.01c0.33,0,0.88-0.14,0.88-0.72c0-0.39-0.31-0.65-0.75-0.65 c-0.32,0-0.53,0.13-0.67,0.3c-0.14,0.18-0.37,0.26-0.58,0.17l-0.08-0.03c-0.3-0.12-0.4-0.5-0.2-0.75C15.67,9.35,16.16,9,16.94,9 c1.09,0,1.54,0.64,1.62,0.75c0.33,0.5,0.28,1.16,0.02,1.57c-0.15,0.22-0.32,0.38-0.52,0.48v0.07c0.28,0.11,0.51,0.28,0.68,0.52 C19.11,12.91,19.07,13.66,18.75,14.15z"/>
                  </g>
                </g>
              </svg>
              <span>
                  <p class="short-margin font-medium text-gray-500 text-xs">
                      Product ID / Lookup Key
                  </p>
                  <p class="text-lg uppercase">
                    {{branchProduct?.product?.lookupKey}}
                  </p>
              </span>
            </div>
          </section>

            <div class="flex items-start space-x-4">
                <svg xmlns="http://www.w3.org/2000/svg"
                  enable-background="new 0 0 24 24"
                  class="text-blue-800 fill-current"
                  height="24px"
                  viewBox="0 0 24 24"
                  width="24px"
                  fill="#000000">
                  <path d="M0 0h24v24H0V0z" fill="none"/>
                  <path d="M2.53 19.65l1.34.56v-9.03l-2.43 5.86c-.41 1.02.08 2.19 1.09 2.61zm19.5-3.7L17.07 3.98c-.31-.75-1.04-1.21-1.81-1.23-.26 0-.53.04-.79.15L7.1 5.95c-.75.31-1.21 1.03-1.23 1.8-.01.27.04.54.15.8l4.96 11.97c.31.76 1.05 1.22 1.83 1.23.26 0 .52-.05.77-.15l7.36-3.05c1.02-.42 1.51-1.59 1.09-2.6zM7.88 8.75c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-2 11c0 1.1.9 2 2 2h1.45l-3.45-8.34v6.34z"/>               
                </svg>
                <div class="w-full relative">
                    <div>
                        <p style="margin-bottom: 0;" 
                            class="short-margin
                            font-medium text-gray-500 text-xs">
                            Name
                        </p>
                        <div class= "md:flex items-start justify-between
                          space-y-4 md:space-y-0
                          md:space-x-4">
                            <p class="text-3xl w-9/12" style="margin-bottom: 0;">
                                {{branchProduct?.product?.name}}
                            </p>
                            <button style="width: 140px;" *ngIf="!hasEditProductRole" 
                                mat-raised-button class="primary-button-color"
                                tooltip="Change Name"
                                (click)="toggleChangeNameForm()">
                                <svg class="inline-block"
                                  xmlns="http://www.w3.org/2000/svg"
                                  height="24px"
                                  viewBox="0 0 24 24"
                                  width="24px"
                                  fill="#fff">
                                  <path d="M0 0h24v24H0V0z" fill="none"/>
                                  <path d="M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>&nbsp; 
                                <span>CHANGE</span>
                            </button>
                        </div>
                    </div>
                    <form [formGroup]="changeNameForm" 
                        *ngIf="showChangeNameForm" 
                        (ngSubmit)="changeProductName()"
                        autocomplete="off" style="z-index: 10000;"
                        class="bg-white w-2/4 my-8 p-8 rounded-md shadow-2xl 
                            absolute right-0 top-10">
                        <span class="flex items-center justify-between space-x-4 mb-4">
                            <p class="text-2xl" style="margin: 0;">Change Name</p>
                            <button mat-button color="warn" 
                                type="button" (click)="toggleChangeNameForm()">
                                <mat-icon>close</mat-icon> &nbsp; 
                                CLOSE
                            </button>
                        </span>
                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Type New Product Name</mat-label>
                            <input #nameTextbox matInput required
                                formControlName="name" />
                            <span *ngIf="nameTextbox.value" matSuffix>
                                <button mat-icon-button type="button"
                                    (click)="clearNameTextBox()">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </span>
                        </mat-form-field>

                        <div class="flex items-start justify-between space-x-4">
                            <p class="w-8/12 red-text font-medium text-xs">
                                {{changeNameNetworkErrorMessage}}
                            </p>

                            <button mat-raised-button 
                                color="warn"
                                [disabled]="changeNameForm.invalid || isChangingProductName">
                                UPDATE NAME
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        
        <div class="mt-8 grid gap-4 md:flex items-start justify-start md:space-x-8">
          <div class="md:w-1/3 relative">
              <p class="font-medium text-gray-500 short-margin">Unit Price</p>
              <span class="flex items-center space-x-4">
                  <p class="text-2xl" style="margin: 0;">
                      GHC {{branchProduct?.product?.sellingPrice?.toFixed(2)}}
                  </p>
                  <button *ngIf="!hasEditProductPriceRole" 
                      (click)="toggleChangePriceForm()"
                      mat-icon-button class="bg-gray-200 text-xs">
                      <svg xmlns="http://www.w3.org/2000/svg"
                        class="text-gray-700 fill-current mx-auto"
                        height="24px"
                        viewBox="0 0 24 24"
                        width="24px"
                        fill="#000">
                        <path d="M0 0h24v24H0V0z" fill="none"/>
                        <path d="M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                      </svg>
                  </button>
              </span>

              <div *ngIf="showChangePriceForm" style="min-height: 100px;" 
                  class="absolute top-10 p-4 z-40
                      rounded-md shadow-2xl bg-white
                      left-48 w-full">
                  <form [formGroup]="changePriceForm" 
                      autocomplete="off"
                      (ngSubmit)="changeProductPrice()">
                      <span class="mb-2 flex items-center justify-between space-x-4">
                          <p style="margin: 0;" class="font-medium">Change Price</p>
                          <button mat-icon-button 
                          type="button"
                          (click)="toggleChangePriceForm()">
                              <mat-icon>close</mat-icon>
                          </button>
                      </span>
                      
                      <mat-form-field appearance="fill" class="w-full text-xs">
                          <mat-label>Cost Price</mat-label>
                          <input matInput required type="number"
                              formControlName="costPrice" />
                      </mat-form-field>
                      <mat-form-field appearance="fill" class="w-full text-xs">
                          <mat-label>Selling Price</mat-label>
                          <input matInput required type="number" 
                          formControlName="sellingPrice" />
                      </mat-form-field>

                      <button mat-raised-button 
                          color="warn" 
                          class="w-full"
                          [disabled]="isChangingProductPrice || (changePriceForm.invalid)">
                          UPDATE PRICE
                      </button>
                  </form>
              </div>
          </div>
          <div class="relative">
              <p class="font-medium text-gray-500 short-margin">Quantity</p>
              <span class="flex items-center space-x-4">
                  <p class="text-2xl" style="margin: 0;">
                      {{branchProduct?.quantity}}
                  </p>
                  <button mat-icon-button color="primary"
                    class="bg-gray-200" (click)="editQuantity()">
                    <span class="flex items-center space-x-4 justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg"
                        class="text-gray-700 fill-current"
                        height="24px"
                        viewBox="0 0 24 24"
                        width="24px"
                        fill="#000">
                        <path d="M0 0h24v24H0V0z" fill="none"/>
                        <path d="M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                      </svg>
                    </span>
                  </button>
              </span>
          </div>
          <div class="relative">
              <p class="font-medium text-gray-500 short-margin">Delete</p>
              <span class="flex items-center space-x-4">
                  <button mat-icon-button color="primary"
                    class="bg-gray-200" (click)="deleteProduct()">
                    <span class="flex items-center space-x-4 justify-center">
                      <!-- <span>CHANGE QUANTITY</span> -->
                      <svg xmlns="http://www.w3.org/2000/svg"
                        class="text-gray-700 fill-current"
                        height="24px"
                        viewBox="0 0 24 24"
                        width="24px"
                        fill="#000">
                        <path d="M0 0h24v24H0V0z" fill="none"/>
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"/>
                      </svg>
                    </span>
                  </button>
              </span>
          </div>
        </div>
      </section>
    </section>
  </span>

</section>