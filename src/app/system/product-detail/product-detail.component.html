
<section>
    <span class="flex items-start space-x-4">
        <app-back-button></app-back-button> &nbsp; 
        <section class="space-y-8 w-full">
            <p class="text-3xl font-light" style="margin: 0;">Product Details</p>

            <section style="margin-top: 3rem;">
                <section class=" border-b-2 border-gray-200 pb-4">
                    <div class="my-4 flex items-center space-x-4">
                        <mat-icon class="text-red-500">pin</mat-icon>
                        <span>
                            <p class="short-margin font-medium text-gray-500 text-xs">
                                Product ID / Lookup Key
                            </p>
                            <p class="text-lg">{{product?.lookupKey}}</p>
                        </span>
                    </div>
    
                    <div class="flex items-start space-x-4">
                        <mat-icon class="text-blue-700">style</mat-icon>
                        <div class="w-full relative">
                            <div>
                                <p style="margin-bottom: 0;" 
                                    class="short-margin
                                        font-medium text-gray-500 text-xs">
                                    Name
                                </p>
                                <span class= "flex items-start justify-between space-x-4">
                                    <p class="text-3xl w-9/12" style="margin-bottom: 0;">
                                        {{product?.name}}
                                    </p>
                                    <button *ngIf="hasEditProductRole" 
                                        mat-raised-button class="primary-button-color"
                                        (click)="toggleChangeNameForm()">
                                        <mat-icon>edit</mat-icon> &nbsp; 
                                        <span>CHANGE</span>
                                    </button>
                                </span>
                            </div>
                            <form [formGroup]="changeNameForm" 
                                *ngIf="showChangeNameForm" 
                                (ngSubmit)="changeProductName()"
                                autocomplete="off" style="z-index: 10000;"
                                class="bg-white w-2/4 my-8 p-8 rounded-md shadow-2xl 
                                    absolute right-0 top-10">
                                <span class="flex items-center justify-between space-x-4 mb-4">
                                    <p class="text-2xl" style="margin: 0;">Change Name</p>
                                    <button mat-button color="warn" 
                                        type="button" (click)="toggleChangeNameForm()">
                                        <mat-icon>close</mat-icon> &nbsp; 
                                        CLOSE
                                    </button>
                                </span>
                                <mat-form-field appearance="fill" class="w-full">
                                    <mat-label>Type New Product Name</mat-label>
                                    <input #nameTextbox matInput required
                                        formControlName="name" />
                                    <span *ngIf="nameTextbox.value" matSuffix>
                                        <button mat-icon-button type="button"
                                            (click)="clearNameTextBox()">
                                            <mat-icon>close</mat-icon>
                                        </button>
                                    </span>
                                </mat-form-field>

                                <div class="flex items-start justify-between space-x-4">
                                    <p class="w-8/12 red-text font-medium text-xs">
                                        {{changeNameNetworkErrorMessage}}
                                    </p>

                                    <button mat-raised-button 
                                        color="warn"
                                        [disabled]="changeNameForm.invalid || isChangingProductName">
                                        UPDATE NAME
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
                
                <div class="mt-8 flex items-start justify-start space-x-8">
                    <div class="w-1/3 relative">
                        <p class="font-medium text-gray-500 short-margin">Unit Price</p>
                        <span class="flex items-center space-x-4">
                            <p class="text-2xl" style="margin: 0;">
                                GHC {{product?.sellingPrice?.toFixed(2)}}
                            </p>
                            <button *ngIf="hasEditProductPriceRole" 
                                (click)="toggleChangePriceForm()"
                                mat-icon-button class="bg-gray-200 text-xs">
                                <mat-icon>edit</mat-icon>
                            </button>
                        </span>

                        <div *ngIf="showChangePriceForm" style="min-height: 100px;" 
                            class="absolute top-10 p-4 
                                rounded-md shadow-2xl bg-white
                                left-48 w-full">
                            <form [formGroup]="changePriceForm" 
                                autocomplete="off"
                                (ngSubmit)="changeProductPrice()">
                                <span class="mb-2 flex items-center justify-between space-x-4">
                                    <p style="margin: 0;" class="font-medium">Change Price</p>
                                    <button mat-icon-button 
                                    type="button"
                                    (click)="toggleChangePriceForm()">
                                        <mat-icon>close</mat-icon>
                                    </button>
                                </span>
                                
                                <mat-form-field appearance="fill" class="w-full text-xs">
                                    <mat-label>Cost Price</mat-label>
                                    <input matInput required type="number"
                                        formControlName="costPrice" />
                                </mat-form-field>
                                <mat-form-field appearance="fill" class="w-full text-xs">
                                    <mat-label>Selling Price</mat-label>
                                    <input matInput required type="number" 
                                    formControlName="sellingPrice" />
                                </mat-form-field>
    
                                <button mat-raised-button 
                                    color="warn" 
                                    class="w-full"
                                    [disabled]="isChangingProductPrice || (changePriceForm.invalid)">
                                    UPDATE PRICE
                                </button>
                            </form>
                        </div>
                    </div>
                    <span class="w-1/3">
                        <p class="font-medium text-gray-500 short-margin">Total Quantity In All Branches</p>
                        <p class="text-2xl">{{product?.quantity}} Items</p>
                    </span>
                    <span class="w-1/3">
                        <p class="font-medium text-gray-500 short-margin">Total Price</p>
                        <p class="text-2xl">
                            GHC {{(product?.quantity * product?.sellingPrice)?.toFixed(2)}}
                        </p>
                    </span>
                </div>
            </section>

            <section>
                <p class="font-medium">Available in these branches</p>
                <ul>
                    <li *ngFor="let productBranch of product?.productBranches" 
                        class="flex items-start pb-2 mb-2 border-b-2">
                        <mat-icon class="text-blue-600">storefront</mat-icon> &nbsp; &nbsp; 
                        <div class="w-full flex items-center justify-between">
                            <div>
                                <p class="text-base" style="margin: 0;">
                                    {{productBranch?.branch?.name}}
                                </p>
                                <p class="text-xs" style="margin: 0;">
                                    <span class="text-gray-600">Quantity In Stock: </span> 
                                    <span class="text-gray-800 font-semibold">
                                        {{productBranch?.quantity}},
                                    </span> &nbsp; 
                                    <span class="text-gray-600">Total price: </span> 
                                    <span class="text-gray-800 font-semibold">
                                        GHC {{(product?.sellingPrice * productBranch?.quantity)?.toFixed(2)}}
                                    </span>
                                </p>
                            </div>
                            <!-- *ngIf="(productBranch?.branch?.id == staffBranchId) && hasEditProductRole" -->
                            <button 
                                style="background: rgba(219, 235, 255, 0.623);" 
                                mat-button color="primary"
                                (click)="editProductQuantity(productBranch)">
                                <mat-icon>edit</mat-icon> &nbsp; 
                                <span>EDIT QUANTITY</span>
                            </button>
                        </div>
                    </li>
                </ul>
            </section>

        </section>
    </span>

</section>